<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

    <h1>Bob</h1>

    <button id = "button-start">start connect</button>

    <textarea id = "input-answer"></textarea>
    <button id = "button-accept">Accept answer</button>

    <button id = 'button-init'>start</button>

    <video controls autoplay></video>

    <script type="text/javascript">
		var mimeCodec = 'video/webm;codecs=vp9';
		var mediaSource = new MediaSource();
		const video = document.querySelector('video');
		//console.log(mediaSource.readyState); // closed
		video.src = URL.createObjectURL(mediaSource);
		mediaSource.addEventListener('sourceopen', sourceOpen);

		let sourceBuffer;

		function sourceOpen (_) {
			console.log("==");
			//console.log(this.readyState); // open
			var mediaSource = this;
			sourceBuffer = mediaSource.addSourceBuffer(mimeCodec);

		}

		document.getElementById('button-init').addEventListener('click',async  () => {

			const stream = await navigator.mediaDevices.getUserMedia({video: true});

			const reader = new MediaRecorder(stream, {mimeType: 'video/webm;codecs=vp9'});

			reader.ondataavailable = e => {


				readChunk(e.data);
            };
            reader.start(200);


        })
		function readChunk(data) {
			const reader = new FileReader();
			reader.onload = function(e) {
				// как только FileReader будет готов, и загрузит себе кусочек видеопотока
				// мы "прицепляем" перекодированный в Uint8Array (был Blob) кусочек в буфер, связанный
				// с проигрывателем, и проигрыватель начинает воспроизводить полученный кусочек видео/аудио
				sourceBuffer.appendBuffer(new Uint8Array(e.target.result));

				reader.onload = null;
			}
			reader.readAsArrayBuffer(data);
		}

    </script>
</body>
</html>
